var Lt=(a,u,n)=>{if(!u.has(a))throw TypeError("Cannot "+n)};var o=(a,u,n)=>(Lt(a,u,"read from private field"),n?n.call(a):u.get(a)),Z=(a,u,n)=>{if(u.has(a))throw TypeError("Cannot add the same private member more than once");u instanceof WeakSet?u.add(a):u.set(a,n)};(function(a,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(a=typeof globalThis<"u"?globalThis:a||self,u(a["lw-math"]={}))})(this,function(a){var g;"use strict";var u=(t=>(t.Term="t",t.Factor="f",t))(u||{}),n=(t=>(t.Add="+",t.Sub="-",t.Div="/",t.Mul="*",t))(n||{}),$=(t=>(t.Root="~",t.Function="f()",t.Brackets="()",t.Number="n",t.Constant="c",t.PostfixOperator="po",t))($||{});const c=t=>t.type==="t",M=t=>t.type==="f",b=t=>r=>M(r)&&r.name===t,y=b("~"),x=b("()"),f=b("f()"),C=b("c"),m=b("n"),w=b("po"),N=t=>y(t)||x(t)||f(t),A=t=>f(t)||x(t),L=t=>Object.keys(t),H=()=>({type:u.Factor,name:$.Root,$$expressions:[]}),J=()=>({type:u.Factor,name:$.Brackets}),K=(t,r,e)=>({type:u.Factor,name:$.Function,value:t,left:e==null?void 0:e.arg,right:e==null?void 0:e.body,isClosed:r&&!!(e!=null&&e.arg)&&!!(e!=null&&e.body),isArgRequired:r}),Q=t=>({type:u.Factor,name:$.Constant,value:t}),T=(t,r=!1)=>({type:u.Factor,name:$.Number,value:t,isConst:r}),tt=(t,r)=>({type:u.Factor,name:$.PostfixOperator,value:t,left:void 0,right:r}),E=t=>({type:u.Term,name:t}),I={0:/^[()]$/,1:/^(\w+)\(([\w.]+)?(,?)\s?([\w.]+)?\)?$/,2:/^[.\dE]+$/,3:/^[a-zA-Z]+$/,4:/^[!%]$/,5:/^[-/+*]$/},rt=(t,r=L(I))=>{let e=null,i;for(let s of r)if(e=I[s].exec(t),e){i=s;break}return[i,e]},et=(t,r)=>{if(t==="2")return T(r[0],r[0].length>1);if(t==="3")return Q(r[0]);if(t==="5")return E(r[0]);if(t==="4")return tt(r[0]);if(t==="0"&&r[0]==="(")return J();if(t==="1"){const[,e,i,s,l]=r;let h=i?B(i,["2","3"]):void 0,qt=l?B(l,["2","3"]):void 0;return K(e,!!s,{arg:s?h:void 0,body:s?qt:h})}throw new Error('Unexpected value."')},B=(t,r=L(I))=>{const[e,i]=rt(t,r);if(!e||!i)throw new Error(`Unexpected string ${t}`);return et(e,i)},W={[n.Add]:1,[n.Sub]:1,[n.Div]:2,[n.Mul]:2},k=t=>c(t)?W[t.name]:3,F=(t,r)=>t.right&&!N(t.right)&&!w(t.right)?F(t.right,t):[t,r],U=(t,r,e)=>t.right&&c(t.right)&&W[t.right.name]===r?[t.right,t]:t.right&&c(t.right)?U(t.right,r,t):[t,e],it=(t,r)=>r.name!==n.Sub||r.name===n.Sub&&t.name===n.Add,st=t=>c(t)&&(!t.left&&!t.right||!!t.right&&c(t.right)&&!t.right.left),S=(t,r)=>{const e=k(r),[i,s]=U(t,e);if(!st(i)){if(c(i)&&i.left&&!i.right&&s){if(i.name===r.name)return;if(it(i,r))return r.left=i.left,i.left=void 0,s.right=r,r}if(!(!(s??i).right&&r.name!==n.Sub))return e>1&&k(i)<2||c(i)&&!i.right?(r.left=i.right,i.right=r):(r.left=(s??i).right,(s??i).right=r),r}},j=t=>t.value.includes("E"),nt=t=>t.value.includes("."),ut=t=>!t.value.endsWith("."),ct=(t,r)=>{if(!(r.value==="E"&&(!ut(t)||j(t)))&&!(r.value==="."&&(nt(t)||j(t)))){if(t.value==="0"&&r.value!=="E"&&r.value!=="."){t.value=r.value;return}t.value+=r.value}},at=(t,r)=>{let[e]=F(t);if(m(e)&&!(r.isConst||e.isConst)){ct(e,r);return}M(e)&&(!N(e)||e.right)&&(e=S(t,E(n.Mul))??e),e.right=r},lt=(t,r)=>{let[e]=F(t);M(e)&&(!N(e)||e.right)&&(e=S(t,E(n.Mul))??e),e.right=r},ht=(t,r)=>{let[e,i]=F(t);y(e)&&!e.right||c(e)&&!e.right||(c(e)?(r.right=e.right,e.right=r):(r.right=(i??e).right,(i??e).right=r))},z=(t,r)=>{let[e]=F(t);return M(e)&&(e=S(t,E(n.Mul))??e),e.right=r,r},gt=(t,r)=>{let[e,i]=F(t);if(e.right&&A(e.right)&&e.right.isClosed&&!r.left)i=e,e=e.right;else if(c(e)&&!e.right&&!r.left)return;if(!y(e)&&i&&!r.left)return r.left=i.right,i.right=r,r.left&&r.right&&(r.isClosed=!0),r;if(r.left)return M(e)&&!N(e)&&(e=S(t,E(n.Mul))??e),e.right=r,r},_=t=>{const[r,e]=F(t);if(r.right&&w(r.right)){r.right=r.right.right;return}if(r.right&&f(r.right)&&r.right.isArgRequired){if(!r.right.right){r.right=r.right.left;return}_(r.right);return}if(r.right&&A(r.right)){if(r.right.isClosed){r.right.isClosed=!1;return}if(!r.right.right){r.right=void 0;return}_(r.right);return}if(m(r)){(r.isConst||r.value.length===1)&&e?e.right=void 0:r.value=r.value.slice(0,-1);return}if(C(r)&&e){e.right=void 0;return}if(c(r)&&e){e.right=r.left;return}},G=(t,r)=>{t.right=typeof r=="string"?B(r):typeof r=="number"?T(String(r),String(r).length>1):void 0,t.right&&N(t.right)&&t.$$expressions.splice(0,t.$$expressions.length,t.right)},ft=(t,r)=>{t.$$expressions[0]&&!t.$$expressions[0].right&&t.$$expressions.shift(),t.$$expressions[0]&&f(t.$$expressions[0])&&t.$$expressions[0].isClosed&&(t.$$expressions[0].isClosed=!1),_(t),t.right||G(t,r)},P=t=>t.$$expressions.find(r=>A(r)&&!r.isClosed)??t,R=(t,r)=>{const e=P(t),s=f(e)&&e.isArgRequired&&e.right&&(!c(e.right)||c(e.right)&&!!e.right.right),l=r&&e.right&&m(r)&&!r.isConst&&m(e.right)&&!e.right.isConst;s&&!l&&!(r&&f(r)&&r.isArgRequired)&&(e.isClosed=!0,R(t,r))},ot=t=>{let r=P(t);const[e]=F(r);f(r)&&r.isArgRequired&&(R(t),r=P(t)),A(r)&&r.right&&(!c(e)||c(e)&&e.right)&&(r.isClosed=!0)},dt=(t,r)=>{R(t,r);const e=P(t);let i;c(r)?S(e,r):m(r)?at(e,r):C(r)?lt(e,r):w(r)?ht(e,r):x(r)?i=z(e,r):f(r)&&(r.isArgRequired?i=gt(e,r):i=z(e,r)),i&&t.$$expressions.unshift(i)},Ft=(t,r)=>{var h;const e=t.left?p(t.left,r):"",i=t.right?p(t.right,r):"",s=((h=r.operators)==null?void 0:h[t.name])||t.name,l=t.left&&c(t.left)&&k(t.left)>1&&k(t)<2;return`${e}${e?" ":""}${s}${e&&!l&&i?" ":""}${i}`},pt=(t,r)=>{const e=t.right?p(t.right,r):"";return(r.renderBrackets??V.renderBrackets)({body:e,isClosed:!!t.isClosed})},vt=(t,r)=>{var s,l;const e=t.left?p(t.left,r):"",i=t.right?p(t.right,r):"";return(((s=r.renderFunction)==null?void 0:s[t.value])??((l=r.renderFunction)==null?void 0:l.default)??V.renderFunction.default)({left:e,right:i,name:t.value,isClosed:!!t.isClosed})},V={renderBrackets:({body:t,isClosed:r})=>`(${t}${r?")":""}`,renderFunction:{default:({name:t,left:r,right:e,isClosed:i})=>`${t}(${r?`${r}, `:""}${e}${i?")":""}`},constants:{},operators:{}},p=(t,r={})=>{var e;return y(t)&&t.right?p(t.right,r):c(t)?Ft(t,r):x(t)?pt(t,r):f(t)?vt(t,r):m(t)?t.value:C(t)?((e=r.constants)==null?void 0:e[t.value])??t.value:w(t)?`${t.right?p(t.right,r):""}${t.value}`:""},D=t=>t*Math.PI/180,O=t=>t*180/Math.PI,$t=(t,r)=>t+r,mt=(t,r)=>t-r,bt=(t,r)=>t/r,yt=(t,r)=>t*r,Mt=Math.pow,xt=(t,r)=>Math.abs(t)**(1/r)*(t<0?-1:1),wt=(t,r)=>v(Math.sin(r==="deg"?D(t):t),11),Nt=(t,r)=>v(Math.cos(r==="deg"?D(t):t),11),Et=(t,r)=>{const e=Math.tan(r==="deg"?D(t):t);return e>Number.MAX_SAFE_INTEGER?Number.POSITIVE_INFINITY:e},St=(t,r)=>{if(t>1||t<-1)throw new Error("Argument of arcsin expected value in range = -1 <= a <= 1");const e=Math.asin(t);return r==="deg"?O(e):e},Ct=(t,r)=>{if(t>1||t<-1)throw new Error("Argument of acos expected value in range = -1 <= a <= 1");const e=Math.acos(t);return r==="deg"?O(e):e},At=(t,r)=>{const e=Math.atan(t);return r==="deg"?O(e):e},Bt=t=>Math.sqrt(t),kt=t=>Math.log(t),Pt=t=>Math.log10(t),v=(t,r=0)=>Number.parseFloat(t.toFixed(r)),X=t=>{let r=t;const e=7,i=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];if(r<.5)return Math.PI/Math.sin(r*Math.PI)/X(1-r);r--;let s=i[0];for(let h=1;h<e+2;h++)s+=i[h]/(r+h);const l=r+e+.5;return Math.sqrt(2*Math.PI)*l**(r+.5)*Math.exp(-l)*s},Tt=t=>{if(t%1!==0)return X(t+1);if(t===0)return 1;let e=t;for(let i=Math.abs(t);--i;)e*=i;return e},It=t=>{let[r,e]=t.value.split("E");return r==="."&&(r=`${r}0`),parseFloat(r||"1")*(e?10**Number(e):1)},q={isDegree:!1,defineFunctions:{sin:(t,r,{options:e})=>v(wt(r,e.isDegree?"deg":"rad"),11),cos:(t,r,{options:e})=>v(Nt(r,e.isDegree?"deg":"rad"),11),tan:(t,r,{options:e})=>v(Et(r,e.isDegree?"deg":"rad"),11),arcsin:(t,r,{options:e})=>v(St(r,e.isDegree?"deg":"rad"),11),arccos:(t,r,{options:e})=>v(Ct(r,e.isDegree?"deg":"rad"),11),arctan:(t,r,{options:e})=>v(At(r,e.isDegree?"deg":"rad"),11),ln:(t,r)=>kt(r),log:(t,r)=>Pt(r),sqrt:(t,r)=>Bt(r),pow:(t,r)=>{if(typeof t!="number")throw new Error("unknown argument");return Mt(t,r)},root:(t,r)=>{if(typeof t!="number")throw new Error("Unknown argument");return xt(t,r)}},postfixOperators:{"!":(t,r)=>Tt(r),"%":(t,r,{parent:e,options:i})=>e&&c(e)&&e.left&&[n.Sub,n.Add].includes(e.name)?d(e.left,i)/100*r:r/100},defineConst:{Pi:Math.PI,e:Math.E}},_t=(t,r)=>{if(!t.left&&t.name!==n.Sub||!t.right)throw new Error(`Operator "${t.name}" cannot be evaluated`);const e=t.left?d(t.left,r,t):0,i=d(t.right,r,t);return{[n.Add]:$t,[n.Sub]:mt,[n.Mul]:yt,[n.Div]:bt}[t.name](e,i)},Rt=(t,r,e)=>{var h;if(!t.right||t.isArgRequired&&!t.left)throw new Error(`Function ${t.value} missed an argument.`);const i=((h=r.defineFunctions)==null?void 0:h[t.value])??q.defineFunctions[t.value];if(!i)throw new Error(`Unknown function "${t.value}"`);const s=t.left&&d(t.left,r,t),l=t.right&&d(t.right,r,t);return i(s,l,{node:t,parent:e,options:r})},Dt=(t,r,e)=>{var l;const i=((l=r.postfixOperators)==null?void 0:l[t.value])??q.postfixOperators[t.value];if(!i||!t.right)throw new Error(`Unknown operator "${t.value}" or operand is undefined.`);const s=d(t.right,r,t);return i(void 0,s,{node:t,parent:e,options:r})},d=(t,r={},e)=>{var i;if(c(t))return _t(t,r);if(m(t))return It(t);if(C(t))return((i=r.defineConst)==null?void 0:i[t.value])??q.defineConst[t.value];if(f(t))return Rt(t,r,e);if(w(t))return Dt(t,r,e);if(x(t)){if(!t.right)throw new Error("Empty bracket.");return d(t.right,r,t)}return y(t)?t.right?d(t.right,r,t):0:Number.NaN};class Y{constructor(r){Z(this,g,H());this.defaultValue=r,this.setValue(r)}get root(){return o(this,g)}setValue(r){r&&typeof r=="object"&&y(r)?(o(this,g).right=r.right,o(this,g).$$expressions=r.$$expressions):G(o(this,g),r)}push(r){if(typeof r=="number"){this.pushNode(T(String(r),String(r).length>1));return}if(r===")"){this.closeBracket();return}this.pushNode(typeof r=="string"?B(r):r)}pushNode(r){dt(o(this,g),r)}pop(){ft(o(this,g),this.defaultValue)}closeBracket(){ot(o(this,g))}render(r){return p(o(this,g),r)}evaluate(r){return d(o(this,g),r)}}g=new WeakMap;const Ot=t=>new Y(t);a.Expression=Y,a.createExpression=Ot,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
